<div class="page">
    @if (loading()) {
    <div class="loading">
        <div class="spinner"></div>
        <p>Loading conference...</p>
    </div>
    } @else if (conference()) {
    <div class="conference-header">
        <a routerLink="/conferences" class="back-link">← Back to Conferences</a>

        <div class="header-content">
            <div class="header-left">
                <div class="header-badges">
                    <app-badge [variant]="conference()!.type === 'ACADEMIC' ? 'default' : 'secondary'">
                        {{ conference()!.type }}
                    </app-badge>
                    <div class="score">
                        @for (star of getStars(conference()!.score); track $index) {
                        <span class="star">★</span>
                        }
                        @for (star of getEmptyStars(conference()!.score); track $index) {
                        <span class="star empty">★</span>
                        }
                    </div>
                </div>
                <h1>{{ conference()!.title }}</h1>
            </div>

            @if (authService.isAdmin()) {
            <div class="header-actions">
                <a [routerLink]="['/conferences', conference()!.id, 'edit']">
                    <app-button variant="outline">Edit</app-button>
                </a>
            </div>
            }
        </div>
    </div>

    <div class="content-grid">
        <app-card>
            <app-card-header>
                <app-card-title>Details</app-card-title>
            </app-card-header>
            <app-card-content>
                <div class="details-grid">
                    <div class="detail-item">
                        <span class="detail-label">Date</span>
                        <span class="detail-value">{{ formatDate(conference()!.date) }}</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Duration</span>
                        <span class="detail-value">{{ conference()!.duration }} minutes</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Enrollments</span>
                        <span class="detail-value">{{ conference()!.numberOfEnrollments }}</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Score</span>
                        <span class="detail-value">{{ conference()!.score }}/5</span>
                    </div>
                </div>
            </app-card-content>
        </app-card>

        <app-card>
            <app-card-header>
                <div class="reviews-header">
                    <app-card-title>Reviews ({{ reviews().length }})</app-card-title>
                    @if (authService.isAdmin()) {
                    <app-button size="sm" (click)="showAddReview.set(true)">
                        + Add Review
                    </app-button>
                    }
                </div>
            </app-card-header>
            <app-card-content>
                @if (loadingReviews()) {
                <div class="loading-inline">
                    <div class="spinner-sm"></div>
                    <span>Loading reviews...</span>
                </div>
                } @else if (reviews().length === 0) {
                <p class="text-muted text-center">No reviews yet</p>
                } @else {
                <div class="reviews-list">
                    @for (review of reviews(); track review.id) {
                    <div class="review-item">
                        <div class="review-header">
                            <div class="review-stars">
                                @for (star of getStars(review.stars); track $index) {
                                <span class="star">★</span>
                                }
                                @for (star of getEmptyStars(review.stars); track $index) {
                                <span class="star empty">★</span>
                                }
                            </div>
                            <span class="review-date">{{ formatDate(review.date) }}</span>
                        </div>
                        <p class="review-text">{{ review.text }}</p>
                        @if (authService.isAdmin()) {
                        <div class="review-actions">
                            <app-button variant="ghost" size="sm" (click)="confirmDeleteReview(review)">
                                Delete
                            </app-button>
                        </div>
                        }
                    </div>
                    }
                </div>
                }
            </app-card-content>
        </app-card>
    </div>
    }

    <!-- Add Review Dialog -->
    <app-dialog [open]="showAddReview()" title="Add Review" description="Write your review for this conference"
        confirmText="Submit" [loading]="savingReview()" (close)="closeReviewDialog()" (confirm)="submitReview()">
        <div class="review-form">
            <div class="form-group">
                <label class="label">Rating</label>
                <div class="star-input">
                    @for (star of [1, 2, 3, 4, 5]; track star) {
                    <button type="button" class="star-btn" [class.active]="newReview.stars >= star"
                        (click)="newReview.stars = star">
                        ★
                    </button>
                    }
                </div>
            </div>
            <div class="form-group">
                <label for="reviewText" class="label">Review</label>
                <textarea id="reviewText" [(ngModel)]="newReview.text" class="textarea" rows="4"
                    placeholder="Write your review here..."></textarea>
            </div>
        </div>
    </app-dialog>

    <!-- Delete Review Dialog -->
    <app-dialog [open]="showDeleteReviewDialog()" title="Delete Review"
        description="Are you sure you want to delete this review?" confirmText="Delete" confirmVariant="destructive"
        [loading]="deletingReview()" (close)="showDeleteReviewDialog.set(false)" (confirm)="deleteReview()" />
</div>